<html>
<head>
    <script src="../web/src/assets/config.js"></script>
    <style>
        #map {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
<div id="map"></div>

<script>
    // Load server coords
    // http://stackoverflow.com/a/39571547/639133
    function getJson(path, callback) {
        var xobj = new XMLHttpRequest();
        xobj.overrideMimeType("application/json");
        xobj.open('GET', path, true);
        xobj.onreadystatechange = function () {
            if (xobj.readyState == 4 && xobj.status == "200") {
                callback(xobj.responseText);
            }
        };
        xobj.send(null);
    }

    function initMap() {
        // Create the map
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 11,
            center: {lat: -33.95, lng: 18.45},
            mapTypeId: 'terrain'
        });

        getJson("concept.json", function (response) {
//            console.info("response", response);
            var json = JSON.parse(response);

            // Plot poly line
            var route = json["routes"][0];
            var routeCoord;
            var pathCoords = [];
            for (var i = 0; i < route.length; i++) {
                routeCoord = route[i];
                pathCoords.push({
                    lat: routeCoord[1],
                    lng: routeCoord[0]
                })
            }
            var path = new google.maps.Polyline({
                path: pathCoords,
                geodesic: true,
                strokeColor: '#FF0000',
                strokeOpacity: 1.0,
                strokeWeight: 2
            });
            path.setMap(map);

            // Plot markers
            // https://developers.google.com/maps/documentation/javascript/markers
            var coords = json["start"];
            for (i = 0; i < coords.length; i++) {
                var coord = coords[i];
                var options = {
                    position: {
                        "lat": coord["latitude"],
                        "lng": coord["longitude"]
                    },
                    map: map,
                    title: coord["description"]
                };
                if (i != 0) {
                    options["icon"] = "http://maps.google.com/mapfiles/ms/icons/yellow-dot.png";
                }
                new google.maps.Marker(options);
            }

            // Add marker for destination
            new google.maps.Marker({
                position: {
                    "lat": routeCoord[1],
                    "lng": routeCoord[0]
                },
                map: map,
                title: "",
                icon: "http://maps.google.com/mapfiles/ms/icons/green-dot.png"
            });
        })
    }

    // Create google map with api_key from config
    var script = document.createElement('script');
    script.src =
        "https://maps.googleapis.com/maps/api/js?key=" +
        window.config.google.api_key +
        "&callback=initMap";
    document.getElementsByTagName('head')[0].appendChild(script);
</script>
</body>
</html>
