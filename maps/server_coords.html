<!--
https://developers.google.com/chart/interactive/docs/gallery/map#overview

http://stackoverflow.com/a/38273383/639133

-->

<html>
<head>
    <script src="../ui/src/assets/config.js"></script>
    <script type="text/javascript"
            src="https://www.gstatic.com/charts/loader.js"></script>

    <style>
        #map_div {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
<div id="map_div"></div>

<script>
    // Create google map with api_key from config
    var script = document.createElement('script');
    script.src =
        "//maps.googleapis.com/maps/api/js?key=" + window.config.google.api_key;
    document.getElementsByTagName('head')[0].appendChild(script);

    // Load server coords
    // http://stackoverflow.com/a/39571547/639133
    function getJson(path, callback) {
        var xobj = new XMLHttpRequest();
        xobj.overrideMimeType("application/json");
        xobj.open('GET', path, true);
        xobj.onreadystatechange = function () {
            if (xobj.readyState == 4 && xobj.status == "200") {
                callback(xobj.responseText);
            }
        };
        xobj.send(null);
    }
    getJson("../server/coords.json", function (response) {
        var coords = JSON.parse(response);
        console.info("coords", JSON.stringify(coords, null, 2));
        console.info("coords.length", coords.length);

        // Create the map chart
        google.charts.load("upcoming", {packages: ["map"]});
        google.charts.setOnLoadCallback(drawChart);
        function drawChart() {
            var coordsArray = [
                ['Lat', 'Long', 'Desc']
            ];
            for (var i = 0; i < coords.length; i++) {
                var coord = coords[i];
                coordsArray.push([
                    coord["latitude"],
                    coord["longitude"],
                    coord["description"]])
            }
            console.info("coordsArray", JSON.stringify(coordsArray, null, 2));
            var data = google.visualization.arrayToDataTable(coordsArray);

            var map = new google.visualization.Map(document.getElementById('map_div'), {
                mapTypeId: "roadmap"
            });
            map.draw(data, {
                showTooltip: true,
                showInfoWindow: true
            });
        }
    })

</script>
</body>
</html>
